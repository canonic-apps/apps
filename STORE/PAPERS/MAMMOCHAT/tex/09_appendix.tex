% ============================================================
% 09_appendix_a.tex
% ============================================================

\appendix
\section*{Appendix - Technical Foundations and Compliance Proofs}

\subsection*{A.7 Notation Reference}
The following notation summarizes mathematical and symbolic conventions used throughout the MammoChat OPTS-EGO technical framework.

\begin{table*}[h!]
\centering
\scriptsize
\caption{Summary of symbols and constructs used in the MammoChat OPTS-EGO framework.}
\label{tab:notation}
\begin{tabular}{@{}p{2.6cm}p{10.8cm}@{}}
\toprule
\textbf{Symbol} & \textbf{Meaning / Description} \\
\midrule
$\mathrm{OPTS}_i$ & Open Provenance Token Standard object for data record $i$; unit of verifiable consent and authorship. \\
$D_i$ & Encrypted payload digest for record $i$ (SHA-3 hash of content). \\
$M_i$ & Metadata conforming to FHIR / mCODE schema (fields: diagnosis, genomics, imaging, therapy)\autocite{ga4gh_phenopackets}. \\
$\sigma_i$ & Patient's digital signature (asymmetric keypair, EGO-verified). \\
$\tau_i$ & Timestamp of consent or ledger entry (UTC ISO 8601 format). \\
$L_t$ & Ledger state hash at time $t$; maintained as append-only chain via $\mathrm{Keccak256}(L_t \,\|\, \mathrm{Tx}_t)$. \\
$\mathrm{Tx}_t$ & Transaction record at block $t$ (e.g., consent, data upload, audit event). \\
$H_i$ & SHA-3 commitment $H_i=\mathrm{SHA3}(D_i\|\!M_i\|\!\sigma_i)$ used in ZKP verification. \\
$Z_i$ & Zero-knowledge proof verifying that transaction $i$ satisfies policy $P_i$ without PHI exposure. \\
$P_i$ & Policy constraint (e.g., HIPAA minimum-necessary rule or 21 Cures Act exception). \\
$R_p$ & Patient's total return: $R_p = \alpha I + \beta S + \gamma D$, composite of impact, social, and data royalty. \\
$I, S, D$ & Components of patient value: Intangible impact, Social benefit, Data-derived royalty. \\
$\alpha, \beta, \gamma$ & Weighting coefficients ($\alpha+\beta+\gamma=1$) determining distribution of patient returns. \\
$Y_v$ & Validator yield: $Y_v=\eta\cdot\mathrm{Stake}\cdot\mathrm{Uptime}\cdot\mathrm{Quality}$. \\
$\eta$ & Policy-compliance multiplier (EGO-governance parameter). \\
$V_j$ & Validator $j$ in EGO consensus network. \\
$\rho_{jk}$ & Governance reputation weight for validator $j$ on policy $k$. \\
$\epsilon$ & Differential-privacy budget controlling trade-off between privacy and accuracy. \\
$M(x)$ & Randomized mechanism generating output distribution over dataset $x$\autocite{consort2010}. \\
$KG=(V,E,\Phi)$ & Knowledge Graph representation: vertices $V$, edges $E$, and feature embeddings $\Phi$. \\
$\Phi$ & Learned vector embeddings from transformer-based or graph-neural models for cohort discovery. \\
DAO & Decentralized Autonomous Organization governing OPTS-EGO in 2030 phase\autocite{bensasson2014ieee,w3c_did_2022}. \\
EGO & Ethical Governance Operators-human or institutional validators enforcing consensus. \\
mCODE & Minimal Common Oncology Data Elements standard for oncology interoperability. \\
FHIR & Fast Healthcare Interoperability Resources API specification for EHR exchange\autocite{hl7_fhir_r4}. \\
\bottomrule
\end{tabular}
\end{table*}

\textbf{Purpose.} Standardizing notation ensures reproducibility across future publications, interoperability with HL7 FHIR / mCODE implementations, and formal alignment with provenance ontologies such as PROV-O and RO-Crate.

\begin{quote}\centering
\textit{``Provenance is policy written in mathematics.''}
\end{quote}

\subsection*{A.1 Cryptographic Architecture}
The OPTS-EGO Ledger is a hybrid architecture combining distributed hash ledgers, zero-knowledge proofs (ZKPs), and verifiable credentials
Its goal is to guarantee provenance, enforce consent, and enable reproducible science without exposing protected health information (PHI).
The framework conforms to security and exchange standards for healthcare identity and device interoperability

Each data object $i$ (mammogram, pathology report, genomic file) is represented as:
\[
\mathrm{OPTS}_i = (D_i, M_i, \sigma_i, \tau_i)
\]
where:
\begin{itemize}
    \item $D_i$ = content-addressed digest (SHA-3 hash of encrypted payload);
    \item $M_i$ = metadata (FHIR/mCODE descriptors);
    \item $\sigma_i$ = patient's digital signature using asymmetric keypair;
    \item $\tau_i$ = ledger timestamp of consent.
\end{itemize}

Ledger updates follow an append-only hash chain ensuring immutability and traceability.

A consent transaction records:
\[
H_i = \mathrm{SHA3}(D_i + M_i + \sigma_i)
\]
and a zero-knowledge proof:\autocite{zk_survey2020}
\[
Z_i = \mathrm{ZKVerify}(H_i, \sigma_i, P_i)
\]
proving that the transaction satisfies policy $P_i$ (e.g., HIPAA minimum-necessary, 21st Century Cures exceptions) without revealing underlying PHI.

\subsection*{A.2 Security and HIPAA Constructive Compliance}
\noindent\textbf{Definition (HIPAA Compliance).}
A system is compliant if it enforces access control, ensures integrity and confidentiality of electronic PHI (ePHI), and maintains auditable activity logs per 45 CFR \S164.306--312.

\noindent\textbf{Lemma 1 (Access Minimality).}
Every OPTS transaction $r$ reveals only policy-satisfying attributes through $Z=\mathrm{ZKVerify}(H,\sigma,P)$, maintaining minimum-necessary disclosure.

\noindent\textbf{Lemma 2 (Immutable Auditability).}
All updates to the ledger follow $L_{t+1}=\mathrm{Keccak256}(L_t + \mathrm{Tx}_t)$, producing an immutable, append-only audit chain.

\noindent\textbf{Lemma 3 (Confidentiality and Integrity).}
AES-256-GCM encryption and SHA-3 commitments guarantee data confidentiality and integrity under standard cryptographic assumptions.

\noindent\textbf{Theorem (Constructive Compliance).}
If Lemmas 1--3 hold and validators $V_j$ are weighted by governance reputation $\rho_{jk}>0$, then the OPTS--EGO Ledger enforces HIPAA administrative, technical, and physical safeguards by design.
\hfill $\square$

\subsection*{A.3 Privacy and Differential Guarantees}
Differential-privacy mechanisms ensure aggregate data sharing without individual exposure:
\[
P(M(x) \in S) \le e^{\epsilon} P(M(x') \in S)
\]
where $\epsilon$ controls the privacy budget
MammoChat's data exports apply adaptive noise calibration tuned for healthcare sensitivity.

\subsection*{A.4 Tokenomics and Circular Flow}
The economic model ensures that patient participation generates measurable and ethical returns.

\noindent\textbf{Patient Royalty Model:}
\[
R_p = \alpha I + \beta S + \gamma D, \qquad \alpha + \beta + \gamma = 1
\]
where:
\begin{itemize}
    \item $I$ = intangible impact (self-efficacy, awareness),
    \item $S$ = social benefit (community contribution),
    \item $D$ = data-derived royalty (research or industry reuse).
\end{itemize}

\noindent\textbf{Validator Yield Function:}
\[
Y_v = \eta \cdot \mathrm{Stake} \cdot \mathrm{Uptime} \cdot \mathrm{Quality}
\]
where $\eta$ is the policy-compliance multiplier governed by EGO consensus.

\begin{figure}
\centering
\resizebox{\linewidth}{!}{%
\begin{tikzpicture}[>=Latex]
\tikzstyle{cnode}=[circle, draw=slate, fill=mammoPink!10,
                   minimum size=3.2em, inner sep=2pt, align=center]
\node[cnode] (ack)  at (0, 0)   {Acknowledge};
\node[cnode] (clar) at (4, 0)   {Clarify};
\node[cnode] (emp)  at (4,-3.5) {Empower};
\node[cnode] (rein) at (0,-3.5) {Reinforce};
\draw[->, thick] (ack)  -- node[above]{\small validate} (clar);
\draw[->, thick] (clar) -- node[right]{\small explain}  (emp);
\draw[->, thick] (emp)  -- node[below]{\small options}  (rein);
\draw[->, thick] (rein) -- node[left]{\small connect}   (ack);
\draw[->, thick, bend left=20, looseness=0.9, gray!60] (rein) to node[below left]{\tiny reflection loop} (ack);
\end{tikzpicture}}
\caption{Empathetic dialogue loop with orthogonal nodes:
Acknowledge $\rightarrow$ Clarify $\rightarrow$ Empower $\rightarrow$ Reinforce $\rightarrow$ (loop).}
\end{figure}

\subsection*{A.5 Knowledge Graph for Precision Medicine}
The ledger integrates with a dynamic graph database $KG=(V,E,\Phi)$, where:\autocite{dbgap,gnomad}
\begin{itemize}
    \item $V$ = entities (patients, trials, providers, datasets);
    \item $E$ = edges representing consented relationships;
    \item $\Phi$ = learned embeddings derived from transformer-based models.
\end{itemize}
This structure allows efficient retrieval of trial eligibility and cohort discovery while preserving individual privacy.

\subsection*{A.6 Future Work: Formal Verification and DAO Governance}
Future phases will include:
\begin{itemize}
    \item Formal verification of smart-contract security using Coq or Isabelle.
    \item Governance DAO prototype for decentralized oversight by patient and clinician stakeholders.
    \item Integration of consent oracles for dynamic policy adaptation.
\end{itemize}

\textbf{Summary.}
The OPTS--EGO Ledger transforms compliance from static documentation into active proof, enabling a trustworthy infrastructure for patient-owned AI and precision medicine.
